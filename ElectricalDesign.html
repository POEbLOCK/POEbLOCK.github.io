<!DOCTYPE HTML>
<!--
	TXT by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Electical Design</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.dropotron.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-desktop.css" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>
	<body>

		<!-- Nav -->
		<nav id="nav" class="skel-layers-fixed">
				<ul>
					<li><a href="index.html">Home</a></li>
					<li><a href="MechanicalDesign.html">Mechanical</a></li>
					<li class="current"><a href="ElectricalDesign.html">Electrical</a></li>
					<li><a href="SoftwareDesign.html">Software</a></li>
					<li><a href="Integration.html">Integration</a></li>
					<li>
						<a href="">More Information</a>
						<ul>
							<li><a href="BudgetBreakdown.html">Budget Breakdown</a></li>
							<li><a href="ContactUs.html">About Us</a></li>
						</ul>
					</li>
				</ul>
			</nav>
		<!-- Main -->
			<div id="main-wrapper">
				<div id="main" class="container">
					<div class="row">
						<div class="12u">
							<div class="content">
							
								<!-- Content -->
						
									<article class="box page-content">

										<header>
											<h2>Electrical Design</h2>
										</header>
										<section>
											<p>The electrical system uses an Arduino microcontroller and a Bluetooth Low Energy shield to actuate a servo. In each iteration shown below, more and more functionality is added to the Arduino Bluetooth communication and the electrical system as a whole. Our final bLOCK contains a fully functioning electrical system that is battery-powered, rechargeable, and continuously communicates with your phone to keep your bike safe.
											</section>
										
										<section>
											<h3>Iteration 1
											</h3>
											<p>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In this iteration, multiple design decisions regarding the electrical system for the project had to be made. The microcontroller we would run our code on and which Bluetooth Low Energy (BLE) module for our selected microcontroller had to be purchased. After some initial research, we had the idea of using a Tessel as our microcontroller which already has a designated BLE module. After talking to our instructors about this decision, we pulled away from the idea due to the fact that none of the instructors or course assistants had experience working with a Tessel. In addition, working with a Tessel meant writing code in JavaScript, which is a language neither our electrical or software team had a lot of experience in.
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As a result, at the conclusion of our first iteration, we pivoted to using an Arduino for a microcontroller. We then had the option of picking from a variety of BLE shields from makers such as RedBearLabs, SeeedStudio, or Adafruit. We ultimately ended up choosing the Adafruit shield because of the documentation they provide for their products. We knew that after we got the shield, we could set it up and use it very quickly following their tutorials.</br>

												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For the first iteration of bLOCK, the electrical system consisted of three components: an Adafruit BLE shield, an Arduino Uno, and a servo. The electrical system took as input a single character sent from a pre-built app, Adafruit’s  nRF UART app, that interfaced with our BLE shield. On the Arduino side, the Adafruit BLE UART library provided all the functionality needed to read data sent over Bluetooth from the phone.
												
												</br>

												<img src="images/Iteration_1.png">

												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Taking that character as input, the Arduino actuated the servo to move a cardboard circle between locked and unlocked positions. For this very simple iteration, the Arduino was not sending data back to the phone and there was no form of Bluetooth security between the Arduino and the phone. That is, any phone running the same app would be able to connect and write data to the Arduino. If they provided the correct characters, the lock would unlock.</br>

												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The Adafruit tutorial that we heavily relied on in this iteration is found<a href="https://learn.adafruit.com/getting-started-with-the-nrf8001-bluefruit-le-breakout/introduction"> here.</a></br>

											</p>
										</section>
										
										<section>
											<h3>Iteration 2</h3>
											<p>
												&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In our second iteration, there are no changes to the electrical diagram shown in Iteration 1. However, a lot more functionality was added to the Arduino in terms of reading and writing data over Bluetooth to the phone. The electrical system in this iteration was also fully integrated into the locking mechanism itself.
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbspIn our second iteration, there are no changes to the electrical diagram shown in Iteration 1. However, a lot more functionality was added to the Arduino in terms of reading and writing data over Bluetooth to the phone. The electrical system in this iteration was also fully integrated into the locking mechanism itself.</br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Using more of the Adafruit BLE UART library for the Arduino, the Arduino Uno was now successfully connecting and interfacing with the first iteration of our app. In this iteration, the app consisted of a toggle button that switched the states of the lock when pressed: from locked to unlocked and vice versa. This toggle sent a designated character to the Arduino over Bluetooth, much like in Iteration 1, that then actuated a servo.
</br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In addition, when the Arduino and the phone connect, the phone (as the master in this configuration) reads RSSI values. RSSI stands for Received Signal Strength Indicator and tells the phone how strong the connection between the two devices is. As the phone moves further away from the Arduino, the RSSI gets more and more negative in value.</br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In our second iteration, the Arduino, in addition to receiving lock and unlock input from the app, is also receiving RSSI values. When the user stands at a certain distance away from the lock the bike lock automatically locks. Similarly, when the user stands close to the lock, the bike lock automatically unlocks. In this iteration, the user simply needs to stand close enough or far away enough from the lock for the servo to actuate. The lock can still always be controlled via the app’s toggle button.</br>



											</p>
											
										<section>
											<h3>Iteration 3</h3>
											<p>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In our third iteration, we swapped out the Arduino Uno, which was far larger a microcontroller than we needed, for an Arduino Micro. We had to choose between the Arduino Nano and the Arduino Micro. Ultimately, we chose the Micro despite it being the more expensive of the two, because the Nano is no longer produced and the Micro had all of the functionality we needed for our bLOCK.
</br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In addition to swapping in the Micro, in this iteration we powered the lock with a 9V battery simply to check that we could power our bike lock with a battery. We then began to scope out our final battery, because we did not need a full 9V. We decided to order a 3.3 V 850 mAh LiPo battery, in addition to a boost board that would convert the 3.3 V to 5 V. The boost board also added the ability to recharge the lock.</br>

												<img src="images/Iteration_3.png"
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In our previous iteration, we worked briefly with the RSSI signal, transmitted from the phone. Our primary goal in the previous iteration was simply to successfully reading the correct RSSI value on the Arduino. However, the RSSI signal is very noisy and jumps around a lot. In addition, our previous iteration simply thresholds the RSSI value. Ultimately, our ideal use case would be to have the lock automatically unlock when the user walks towards the lock and lock when the user is walking away.

 </br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Using the RSSI value as a rough approximation of position, we proceed to average the RSSI values in the form of a rolling average. Each new RSSI value adjusts the average slightly. We then take the difference between the averages and produce a rolling averages of the differences. This average of the differences between the previous RSSI average and the current RSSI average smooth out our RSSI signals enough to determine the direction the user is moving. In this iteration, we successfully implemented our desired RSSI functionality: walking towards the lock automatically unlocks it while walking away automatically locks it.</br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Using the battery-powered Micro, we scoped the total power consumption of the lock. Ideally, we want our bike lock to go without charging for a week. Using the battery we selected, our system can only be powered for approximately 17.5 hours. We countered this by setting a sleep mode for the Arduino, which would reduce power consumption of the lock. The BLE shield connects to an interrupt pin on the Arduino and we were hoping to implement a sleep function that would then wake up the Arduino when Bluetooth data from a phone was being transmitted.</br>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
However, given our time constraints, we were unable to implement this functionality by the end of our final iteration.</br>
											
											</p>
										</section>
										<section>
											<h3>Final Iteration</h3>
											<p>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In our final iteration, our electrical system now has a 3.3 V LiPo battery, a boost board, an Arduino Micro, the Adafruit BLE shield, and a servo. The boost board gives the user the ability to recharge their bike lock. Based on our current specs, the battery will last under a day, so the user will have to charge the bike lock each night.

</br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An extension of our final iteration would be to implement sleep functionality in the Arduino, which would decrease the power consumption of our electrical system. The BLE shield iteself, to run continuously, only needs 1 mA while the entire system requires around 51 mA, with servo actuation peaking at 100 mA.
</br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The electrical system for our final iteration contains a 3.3 V battery connected to our boost board. The EN, VCC, and GND pins from the boost board all connect to a piece of protoboard with a switch. The switch controls whether the bike lock is on or off. From the same protoboard, VCC (which is 5V) and GND connect to 5V and GND rails, which then power the Arduino Micro, the Adafruit BLE shield, and the servo.

 </br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In addition to the new electrical system, the Arduino was updated with a specific protocol for interacting with the phone. To combat rapid connection/disconnection state changes, we implemented a call response protocol that quickly tests whether the phone and Arduino can communicate with each other.</br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;After completing this call-response test, the Arduino checks in its permanent memory (EEPROM) if the bike lock has been paired with a phone before. If it has a recorded passcode in its memory, then the Arduino waits to receive the 4 digit passcode that is the first item the phone sends. If the received passcode does not match the one in memory, the connection is terminated and the phone will not attempt to connect to the Arduino again, as long as the app is not restarted</br>
												<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Only if the received passcode matches the one in memory does the Arduino concede control of the locking mechanism itself to the phone. If both codes match, the phone receives lock control and can actuate the servo to change the state of the lock.</br>
											
											</p>
											<div class= "row">
											<div class="6u">
												
												<!-- Feature -->
													<section class="box feature">
														<a class="image featured"><img src=images/Integration4.JPG></a>
														<h3>The Components</h3>
														<p>
															This is a picture of all of the components placed inside the box.
														</p>
													</div>
											
										
										<div class="6u">
												
												<!-- Feature -->
													<section class="box feature">
														<a class="image featured"><img src=images/Integration.JPG></a>
														<h3>Electrical Final</h3>
														<p>
															Side View of the components. The wires are placed inside keeping the electrical components secure.
														</p>
													</div>
											
										</section>
										

									</article>

							</div>
						</div>
					</div>
					<div class="row 200%">
						<div class="12u">

							<!-- Features -->
								<section class="box features">
									<h2 class="major"><span>Components of our Project</span></h2>
									<div>
										<div class="row">
											<div class="4u">
												
												<!-- Feature -->
													<section class="box highlight">
									
									<ul class="special">
										<li><a href="MechanicalDesign.html" class="icon fa-cog"></a></li>
									</ul>

														<h3><a href="#">
															Mechanical Design</a></h3>
														<p>
															Learn about how the lock was made and its design process.
														</p>
													</section>
										
											</div>
											<div class="4u">
												
												<!-- Feature -->
													<section class="box highlight">
									
									<ul class="special">
										<li><a href="#" class="icon fa-bolt"></a></li>
									</ul>

														<h3><a href="#">
															Electrical Design</a></h3>
														<p>
															What are the electrical componetnts of our design? What is powering everything?
														</p>
													</section>
										
											</div>
											<div class="4u">
												
												<!-- Feature -->
													<section class="box highlight">
									
									<ul class="special">
										<li><a href="SoftwareDesign.html" class="icon fa-laptop"></a></li>
									</ul>

														<h3><a href="#">
															Software Design</a></h3>
														<p>
															What is our firmware? How do things work on the software side of things?
														</p>
													</section>
										
											</div>
											<div class="4u">
												
												<!-- Feature -->
													
											</div>
										</div>
										
									</div>
								</section>

						</div>
					</div>
				</div>
			</div>

		<!-- Footer -->
		<footer id="footer" class="container">
				<div class="row 200%">
					<div class="12u">

						<!-- About -->
							<section>
								<h2 class="major"><span>What's this about?</span></h2>
								<p>
									This is our final project for our Principles of Engineering Class at Franklin W. Olin College of Engineering, Fall 2014.						
								
								<br> We Are: <b>Ashley Funk, Austin Greene, Hannah Wilk,  Kristyn Walker, Yong Seon Lee, & Zoher Ghadyali</b></br></p>

					</div>
				</div>
				<div class="row 200%">
					<div class="12u">

						<!-- Contact -->
							<section>
								<h2 class="major"><span>Get in touch</span></h2>
								<ul class="contact">
									<li><a class="icon fa-facebook" href="#"><span class="label">Facebook</span></a></li>
								</ul>
							</section>
					
					</div>
				</div>

				<!-- Copyright -->
					<div id="copyright">
						<ul class="menu">
							<li>&copy; Untitled. All rights reserved</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</div>

			</footer>

	</body>
</html>